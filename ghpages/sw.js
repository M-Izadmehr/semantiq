/*! For license information please see sw.js.LICENSE.txt */
(()=>{function n(n,t){var r="undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(!r){if(Array.isArray(n)||(r=function(n,t){if(n){if("string"==typeof n)return e(n,t);var r={}.toString.call(n).slice(8,-1);return"Object"===r&&n.constructor&&(r=n.constructor.name),"Map"===r||"Set"===r?Array.from(n):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?e(n,t):void 0}}(n))||t&&n&&"number"==typeof n.length){r&&(n=r);var o=0,a=function(){};return{s:a,n:function(){return o>=n.length?{done:!0}:{done:!1,value:n[o++]}},e:function(n){throw n},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,i=!0,u=!1;return{s:function(){r=r.call(n)},n:function(){var n=r.next();return i=n.done,n},e:function(n){u=!0,c=n},f:function(){try{i||null==r.return||r.return()}finally{if(u)throw c}}}}function e(n,e){(null==e||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function t(){var n,e,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",c=o.toStringTag||"@@toStringTag";function i(t,o,a,c){var i=o&&o.prototype instanceof s?o:s,l=Object.create(i.prototype);return r(l,"_invoke",function(t,r,o){var a,c,i,s=0,l=o||[],f=!1,h={p:0,n:0,v:n,a:p,f:p.bind(n,4),d:function(e,t){return a=e,c=0,i=n,h.n=t,u}};function p(t,r){for(c=t,i=r,e=0;!f&&s&&!o&&e<l.length;e++){var o,a=l[e],p=h.p,d=a[2];t>3?(o=d===r)&&(i=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=n):a[0]<=p&&((o=t<2&&p<a[1])?(c=0,h.v=r,h.n=a[1]):p<d&&(o=t<3||a[0]>r||r>d)&&(a[4]=t,a[5]=r,h.n=d,c=0))}if(o||t>1)return u;throw f=!0,r}return function(o,l,d){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,d),c=l,i=d;(e=c<2?n:i)||!f;){a||(c?c<3?(c>1&&(h.n=-1),p(c,i)):h.n=i:h.v=i);try{if(s=2,a){if(c||(o="next"),e=a[o]){if(!(e=e.call(a,i)))throw TypeError("iterator result is not an object");if(!e.done)return e;i=e.value,c<2&&(c=0)}else 1===c&&(e=a.return)&&e.call(a),c<2&&(i=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=n}else if((e=(f=h.n<0)?i:t.call(r,h))!==u)break}catch(e){a=n,c=1,i=e}finally{s=1}}return{value:e,done:f}}}(t,a,c),!0),l}var u={};function s(){}function l(){}function f(){}e=Object.getPrototypeOf;var h=[][a]?e(e([][a]())):(r(e={},a,function(){return this}),e),p=f.prototype=s.prototype=Object.create(h);function d(n){return Object.setPrototypeOf?Object.setPrototypeOf(n,f):(n.__proto__=f,r(n,c,"GeneratorFunction")),n.prototype=Object.create(p),n}return l.prototype=f,r(p,"constructor",f),r(f,"constructor",l),l.displayName="GeneratorFunction",r(f,c,"GeneratorFunction"),r(p),r(p,c,"Generator"),r(p,a,function(){return this}),r(p,"toString",function(){return"[object Generator]"}),(t=function(){return{w:i,m:d}})()}function r(n,e,t,o){var a=Object.defineProperty;try{a({},"",{})}catch(n){a=0}r=function(n,e,t,o){function c(e,t){r(n,e,function(n){return this._invoke(e,t,n)})}e?a?a(n,e,{value:t,enumerable:!o,configurable:!o,writable:!o}):n[e]=t:(c("next",0),c("throw",1),c("return",2))},r(n,e,t,o)}function o(n,e,t,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void t(n)}i.done?e(u):Promise.resolve(u).then(r,o)}function a(n){return function(){var e=this,t=arguments;return new Promise(function(r,a){var c=n.apply(e,t);function i(n){o(c,r,a,i,u,"next",n)}function u(n){o(c,r,a,i,u,"throw",n)}i(void 0)})}}var c="semantiquest-embeddings",i="v1.0.0",u="".concat(c,"-").concat(i);function s(){return l.apply(this,arguments)}function l(){return(l=a(t().m(function n(){var e,r;return t().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,caches.keys();case 1:if(e=n.v,!((r=e.filter(function(n){return n.startsWith(c)&&n!==u})).length>0)){n.n=2;break}return console.log("SW: Cleaning up old caches:",r),n.a(2,Promise.all(r.map(function(n){return caches.delete(n)})));case 2:return n.a(2)}},n)}))).apply(this,arguments)}function f(){return(f=a(t().m(function e(r){var o,a,s,l,f,h,p,d,v,g,y,m;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,caches.open(u);case 1:return o=e.v,e.n=2,o.match(r);case 2:if(!(a=e.v)){e.n=3;break}return console.log("SW: Serving embeddings from cache (".concat(i,")")),e.a(2,a);case 3:return console.log("SW: Cache miss, fetching embeddings for ".concat(i,"...")),e.n=4,fetch(r);case 4:if(!(s=e.v).ok){e.n=6;break}return e.n=5,o.put(r,s.clone());case 5:console.log("SW: Embeddings cached for ".concat(i));case 6:return e.a(2,s);case 7:return e.p=7,y=e.v,console.error("SW: Error handling embeddings request:",y),e.n=8,caches.keys();case 8:l=e.v,f=l.filter(function(n){return n.startsWith(c)}),h=n(f),e.p=9,h.s();case 10:if((p=h.n()).done){e.n=14;break}return d=p.value,e.n=11,caches.open(d);case 11:return v=e.v,e.n=12,v.match(r);case 12:if(!(g=e.v)){e.n=13;break}return console.log("SW: Serving from fallback cache due to error"),e.a(2,g);case 13:e.n=10;break;case 14:e.n=16;break;case 15:e.p=15,m=e.v,h.e(m);case 16:return e.p=16,h.f(),e.f(16);case 17:throw y;case 18:return e.a(2)}},e,null,[[9,15,16,17],[0,7]])}))).apply(this,arguments)}function h(){return(h=a(t().m(function n(){var e,r;return t().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,caches.keys();case 1:return e=n.v,r=e.filter(function(n){return n.startsWith(c)}),n.a(2,Promise.all(r.map(function(n){return caches.delete(n)})))}},n)}))).apply(this,arguments)}self.addEventListener("install",function(n){console.log("SW: Installing..."),n.waitUntil(self.skipWaiting())}),self.addEventListener("activate",function(n){console.log("SW: Activating..."),n.waitUntil(Promise.all([s(),self.clients.claim()]))}),self.addEventListener("fetch",function(n){new URL(n.request.url).pathname.endsWith("embeddings_quantized.json")&&n.respondWith(function(n){return f.apply(this,arguments)}(n.request))}),self.addEventListener("message",function(n){"CLEAR_EMBEDDINGS_CACHE"===(n.data||{}).action&&(console.log("SW: Clearing embeddings cache..."),n.waitUntil(function(){return h.apply(this,arguments)}().then(function(){var e;console.log("SW: All embeddings caches cleared"),null===(e=n.ports[0])||void 0===e||e.postMessage({success:!0})}).catch(function(e){var t;console.error("SW: Failed to clear caches:",e),null===(t=n.ports[0])||void 0===t||t.postMessage({success:!1,error:e.message})})))})})();